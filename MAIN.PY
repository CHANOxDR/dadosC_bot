import random
from telegram import Update, InlineQueryResultArticle, InputTextMessageContent
from telegram.ext import (
    ApplicationBuilder,
    CommandHandler,
    InlineQueryHandler,
    ContextTypes
)
from uuid import uuid4

TOKEN = "7566352440:AAFpJHdWSZyc96xqkZKO6fx1sMnZG-U4kL0"

async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    mensaje = (
        "Â¡Hola! Soy un bot que tira dados y monedas, estos son mis comandos:\n\n"
        "/moneda - ğŸª™ Tiras una moneda (cara o cruz)\n"
        "/dado - ğŸ² Tiras un dado de 6 caras\n"
        "/dado <nÃºmero> - ğŸ² Tiras un dado con el nÃºmero de caras que quieras\n\n"
        "TambiÃ©n puedes usarme desde cualquier chat escribiendo: @TuNombreDeBot"
    )
    await update.message.reply_text(mensaje)

async def moneda(update: Update, context: ContextTypes.DEFAULT_TYPE):
    numero = random.randint(1, 8222)
    if numero == 1:
        resultado = "ğŸ˜± Â¡La moneda cayÃ³ PARADA! como os gusta ğŸ¥µ..."
    else:
        resultado = f"ğŸª™ La moneda cayÃ³: {random.choice(['Cara', 'Cruz'])}"
    await update.message.reply_text(resultado)

async def dado(update: Update, context: ContextTypes.DEFAULT_TYPE):
    try:
        caras = int(context.args[0]) if context.args else 6
        if caras == 1:
            await update.message.reply_text("ğŸš« Como que un dado de 1 cara que eres, Â¿Pendejo?")
            return
        if caras == 2:
            await update.message.reply_text("ğŸª™ Para eso tira una moneda, Cara Almeja")
            return
        if caras == 6 and context.args:
            await update.message.reply_text("ğŸ¤£ Por personas como tÃº el shampoo trae instrucciones")
            return
    except (IndexError, ValueError):
        await update.message.reply_text("âœï¸ Usa un nÃºmero vÃ¡lido.")
        return

    resultado = random.randint(1, caras)
    await update.message.reply_text(f"ğŸ² Dado de {caras} caras: {resultado}")

async def inline(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.inline_query.query.strip().lower()
    results = []

    if "moneda" in query:
        numero = random.randint(1, 8222)
        if numero == 1:
            resultado = "ğŸ˜± Â¡La moneda cayÃ³ PARADA!"
        else:
            resultado = f"ğŸª™ La moneda cayÃ³: {random.choice(['Cara', 'Cruz'])}"

        results.append(
            InlineQueryResultArticle(
                id=str(uuid4()),
                title="ğŸª™ Lanzar moneda",
                input_message_content=InputTextMessageContent(resultado),
                description="Cara, cruz... o parada ğŸ‘€",
            )
        )
    else:
        try:
            caras = int(query) if query else 6
            if caras < 1:
                raise ValueError
        except ValueError:
            caras = 6

        resultado = random.randint(1, caras)
        results.append(
            InlineQueryResultArticle(
                id=str(uuid4()),
                title=f"ğŸ² Dado de {caras} caras",
                input_message_content=InputTextMessageContent(
                    f"ğŸ² Resultado del dado de ({caras} caras):   {resultado}"
                ),
                description="Haz clic para enviar el resultado",
            )
        )

    await update.inline_query.answer(results, cache_time=1)

def main():
    app = ApplicationBuilder().token(TOKEN).build()

    app.add_handler(CommandHandler("start", start))
    app.add_handler(CommandHandler("help", start))
    app.add_handler(CommandHandler("moneda", moneda))
    app.add_handler(CommandHandler("dado", dado))
    app.add_handler(InlineQueryHandler(inline))

    print("âœ… Bot iniciado con modo inline")
    app.run_polling()

if __name__ == '__main__':
    main()
